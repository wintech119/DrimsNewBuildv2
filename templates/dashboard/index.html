{% extends "base.html" %}
{% block title %}Dashboard - DRIMS{% endblock %}

{% block content %}
<h2><i class="bi bi-speedometer2"></i> System Dashboard</h2>

<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Active Items</h6>
                        <h2 class="mb-0">{{ total_items }}</h2>
                    </div>
                    <div><i class="bi bi-box-seam" style="font-size: 3rem; opacity: 0.5;"></i></div>
                </div>
            </div>
            <div class="card-footer bg-primary bg-opacity-75">
                <a href="{{ url_for('items.list_items') }}" class="text-white text-decoration-none">
                    View Items <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Warehouses</h6>
                        <h2 class="mb-0">{{ total_warehouses }}</h2>
                    </div>
                    <div><i class="bi bi-building" style="font-size: 3rem; opacity: 0.5;"></i></div>
                </div>
            </div>
            <div class="card-footer bg-success bg-opacity-75">
                <a href="{{ url_for('warehouses.list_warehouses') }}" class="text-white text-decoration-none">
                    View Warehouses <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Active Events</h6>
                        <h2 class="mb-0">{{ total_events }}</h2>
                    </div>
                    <div><i class="bi bi-calendar-event" style="font-size: 3rem; opacity: 0.5;"></i></div>
                </div>
            </div>
            <div class="card-footer bg-warning bg-opacity-75">
                <a href="{{ url_for('events.list_events') }}" class="text-white text-decoration-none">
                    View Events <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Total Inventory Value</h6>
                        <h2 class="mb-0">${{ "%.2f"|format(total_inventory_value) }}</h2>
                    </div>
                    <div><i class="bi bi-cash-stack" style="font-size: 3rem; opacity: 0.5;"></i></div>
                </div>
            </div>
            <div class="card-footer bg-info bg-opacity-75">
                <a href="{{ url_for('inventory.list_inventory') }}" class="text-white text-decoration-none">
                    View Inventory <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle-fill"></i> Low Stock Alert</h5>
            </div>
            <div class="card-body">
                {% if low_stock_items %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th class="text-end">Current Stock</th>
                                <th class="text-end">Reorder Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in low_stock_items %}
                            <tr>
                                <td><a href="{{ url_for('items.view', item_id=item.item_id) }}">{{ item.item_name }}</a></td>
                                <td class="text-end">{{ "%.2f"|format(item.total_qty) }}</td>
                                <td class="text-end">{{ "%.2f"|format(item.reorder_level) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">All items are adequately stocked.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header card-header-goj">
                <h5 class="mb-0"><i class="bi bi-building"></i> Warehouse Stock Levels</h5>
            </div>
            <div class="card-body">
                {% if warehouse_stock %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Warehouse</th>
                                <th class="text-end">Items</th>
                                <th class="text-end">Total Qty</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for wh in warehouse_stock %}
                            <tr>
                                <td><a href="{{ url_for('warehouses.view', warehouse_id=wh.warehouse_id) }}">{{ wh.warehouse_name }}</a></td>
                                <td class="text-end">{{ wh.item_count }}</td>
                                <td class="text-end">{{ "%.2f"|format(wh.total_qty) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No inventory data available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header card-header-goj">
                <h5 class="mb-0"><i class="bi bi-list-check"></i> Recent Needs Lists</h5>
            </div>
            <div class="card-body">
                {% if recent_needs %}
                <div class="list-group list-group-flush">
                    {% for need in recent_needs %}
                    <a href="{{ url_for('needs_list.view', needs_list_id=need.needs_list_id) }}" class="list-group-item list-group-item-action">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ need.needs_list_nbr }}</strong> - {{ need.agency.agency_name if need.agency }}
                                <br><small class="text-muted">{{ need.create_dtime.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                            <span class="badge bg-{{ need.status | status_badge('needs_list') }}">{{ need.status }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">No needs lists yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header card-header-goj">
                <h5 class="mb-0"><i class="bi bi-truck"></i> Recent Fulfilments</h5>
            </div>
            <div class="card-body">
                {% if recent_fulfilments %}
                <div class="list-group list-group-flush">
                    {% for ful in recent_fulfilments %}
                    <a href="{{ url_for('fulfilment.view', fulfilment_id=ful.fulfilment_id) }}" class="list-group-item list-group-item-action">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ ful.fulfilment_nbr }}</strong> - {{ ful.warehouse.warehouse_name if ful.warehouse }}
                                <br><small class="text-muted">{{ ful.create_dtime.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                            <span class="badge bg-{{ ful.status | status_badge('fulfilment') }}">{{ ful.status }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">No fulfilments yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header card-header-goj">
                <h5 class="mb-0"><i class="bi bi-calendar-event"></i> Active Events</h5>
            </div>
            <div class="card-body">
                {% if active_events %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Event ID</th>
                                <th>Event Name</th>
                                <th>Type</th>
                                <th>Start Date</th>
                                <th>Parish</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in active_events %}
                            <tr>
                                <td><a href="{{ url_for('events.view', event_id=event.event_id) }}">{{ event.event_id }}</a></td>
                                <td>{{ event.event_name }}</td>
                                <td>{{ event.event_type_desc }}</td>
                                <td>{{ event.event_start_date.strftime('%Y-%m-%d') if event.event_start_date }}</td>
                                <td>{{ event.parish.parish_name if event.parish }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No active events.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
