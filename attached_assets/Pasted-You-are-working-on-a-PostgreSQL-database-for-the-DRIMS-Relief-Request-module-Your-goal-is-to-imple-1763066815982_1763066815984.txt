You are working on a PostgreSQL database for the DRIMS Relief Request module.

Your goal is to implement the following DDL specification for the relief-request feature only, by creating new tables/views and safely adjusting only the explicitly related tables if required.

ðŸ”’ Hard constraints

You must not alter or drop any tables, columns, constraints, or indexes that are unrelated to the relief-request feature.

The only database objects you are allowed to modify (if needed) are:

reliefrqst_status

reliefrqstitem_status

reliefrqst

reliefrqst_item

the views: v_status4reliefrqst_create, v_status4reliefrqst_action

Even for those objects:

Prefer create-if-missing over altering.

Do NOT drop columns, change data types, or drop constraints that already exist.

You may only:

create the table if it does not exist,

add missing columns (if safe),

add missing constraints/indexes (if they donâ€™t already exist),

create or replace the views.

If the existing structure conflicts in a way that would require destructive changes (e.g. dropping a column, changing a type), do not perform the destructive change; instead add a SQL comment describing what the ideal structure should be.

ðŸŽ¯ Target DDL (source of truth)

Use this as the reference for how the relief-request objects should look:

-- Statuses for relief requests
create table reliefrqst_status
(
    status_code      smallint not null
        constraint pk_reliefrqst_status primary key,
    status_desc      varchar(30) not null,
    reason_rqrd_flag boolean not null,
    is_active_flag   boolean not null default TRUE
);
insert into reliefrqst_status values (0, 'DRAFT', FALSE, TRUE);
insert into reliefrqst_status values (1, 'AWAITING APPROVAL', FALSE, TRUE);
insert into reliefrqst_status values (2, 'CANCELLED', FALSE, TRUE);
insert into reliefrqst_status values (3, 'SUBMITTED', FALSE, TRUE);
insert into reliefrqst_status values (4, 'DENIED', TRUE, TRUE);
insert into reliefrqst_status values (5, 'PART FILLED', FALSE, TRUE);
insert into reliefrqst_status values (6, 'CLOSED', TRUE, TRUE);
insert into reliefrqst_status values (7, 'FILLED', FALSE, TRUE);
insert into reliefrqst_status values (8, 'INELIGIBLE', TRUE, TRUE);

-- Views for relief request statuses
create view v_status4reliefrqst_create as
    select status_code, status_desc, reason_rqrd_flag
    from reliefrqst_status
    where status_code in (0,1,2,3) and is_active_flag = TRUE;

create view v_status4reliefrqst_action as
    select status_code, status_desc, reason_rqrd_flag
    from reliefrqst_status
    where status_code in (4,5,6,7,8) and is_active_flag = TRUE;

-- Statuses for actioned items on relief requests
create table reliefrqstitem_status
(
    status_code   char(1)  not null
        constraint pk_reliefrqstitem_status primary key,
    status_desc   varchar(30) not null,
    item_qty_rule char(2) not null
        constraint c_reliefrqstitem_status_2
            check (item_qty_rule in ('EZ','GZ','ER')),
    active_flag   boolean not null default TRUE,
    create_by_id  varchar(20) not null,
    create_dtime  timestamp(0) without time zone not null,
    update_by_id  varchar(20) not null,
    update_dtime  timestamp(0) without time zone not null,
    version_nbr   integer not null
);
insert into reliefrqstitem_status values ('R', 'REQUESTED', 'EZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('U', 'UNAVAILABLE', 'EZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('W', 'AWAITING AVAILABILITY', 'EZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('D', 'DENIED', 'EZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('P', 'PARTLY FILLED', 'GZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('L', 'ALLOWED LIMIT', 'GZ', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);
insert into reliefrqstitem_status values ('F', 'FILLED', 'ER', TRUE, 'system', CURRENT_TIMESTAMP, 'system', CURRENT_TIMESTAMP, 1);

-- Requests for relief submitted by agencies/shelters
create table reliefrqst
(
    reliefrqst_id     integer not null generated by default as identity
        constraint pk_reliefrqst primary key,
    agency_id         integer not null
        constraint fk_reliefrqst_agency references agency,
    request_date      date not null
        constraint c_reliefrqst_1 check (request_date <= CURRENT_DATE),
    tracking_no       varchar(7) not null,
    eligible_event_id integer
        constraint fk_reliefrqst_event references event,
    urgency_ind       char(1) not null
        constraint c_reliefrqst_2 check (urgency_ind in ('L','M','H','C')),
    rqst_notes_text   text,
    review_notes_text text,
    status_code       smallint not null default 0
        constraint fk_reliefrqst_reliefrqst_status references reliefrqst_status,
    status_reason_desc varchar(255)
        constraint c_reliefrqst_3
            check ((status_reason_desc is not null)
                   or (status_reason_desc is null and status_code not in (4,6,8))),
    create_by_id      varchar(20) not null,
    create_dtime      timestamp(0) without time zone not null,
    review_by_id      varchar(20)
        constraint c_reliefrqst_4a
            check ((review_by_id is null and status_code < 2)
                   or (review_by_id is not null and status_code >= 2)),
    review_dtime      timestamp(0) without time zone
        constraint c_reliefrqst_4b
            check ((review_by_id is null and review_dtime is null)
                   or (review_by_id is not null and review_dtime is not null)),
    action_by_id      varchar(20)
        constraint c_reliefrqst_5a
            check ((action_by_id is null and status_code < 4)
                   or (action_by_id is not null and status_code >= 4)),
    action_dtime      timestamp(0) without time zone
        constraint c_reliefrqst_5b
            check ((action_by_id is null and action_dtime is null)
                   or (action_by_id is not null and action_dtime is not null)),
    version_nbr       integer not null
);
create index dk_reliefrqst_1 on reliefrqst(agency_id,request_date);
create index dk_reliefrqst_2 on reliefrqst(request_date,status_code);
create index dk_reliefrqst_3 on reliefrqst(status_code,urgency_ind);

-- Items requested in request for relief
create table reliefrqst_item
(
    reliefrqst_id      integer not null
        constraint fk_reliefrqst_item_reliefrqst references reliefrqst,
    item_id            integer not null
        constraint fk_reliefrqst_item_item references item,
    request_qty        decimal(12,2) not null
        constraint c_reliefrqst_item_1 check (request_qty > 0.00),
    issue_qty          decimal(12,2) not null
        constraint c_reliefrqst_item_2a
            check ((status_code in ('R','U','W','D') and issue_qty = 0)
                   or (status_code in ('P','L') and issue_qty < request_qty)
                   or (status_code in ('F') and issue_qty = request_qty)),
    urgency_ind        char(1) not null
        constraint c_reliefrqst_item_3 check (urgency_ind in ('L','M','H','C')),
    rqst_reason_desc   varchar(255)
        constraint c_reliefrqst_item_4
            check ((rqst_reason_desc is not null)
                   or (rqst_reason_desc is null and urgency_ind in ('L','M'))),
    required_by_date   date
        constraint c_reliefrqst_item_5
            check ((required_by_date is not null)
                   or (required_by_date is null and urgency_ind in ('L','M'))),
    status_code        char(1) not null default 'R'
        constraint fk_reliefrqst_item_reliefrqstitem_status references reliefrqstitem_status,
    status_reason_desc varchar(255)
        constraint c_reliefrqst_item_6b
            check ((status_reason_desc is not null)
                   or (status_reason_desc is null and status_code not in ('D','L'))),
    action_by_id       varchar(20)
        constraint c_reliefrqst_item_7
            check ((action_by_id is null and status_code = 'R')
                   or (action_by_id is not null and status_code != 'R')),
    action_dtime       timestamp(0) without time zone
        constraint c_reliefrqst_item_8
            check ((action_by_id is null and action_dtime is null)
                   or (action_by_id is not null and action_dtime is not null)),
    version_nbr        integer not null,
    constraint pk_reliefrqst_item primary key(reliefrqst_id,item_id)
);
create index dk_reliefrqst_item_2 on reliefrqst_item(item_id,urgency_ind);

ðŸ§¾ What I want you to output

A single SQL migration script that:

Uses CREATE TABLE IF NOT EXISTS for the four relief-request tables.

Uses ALTER TABLE ... ADD COLUMN IF NOT EXISTS and ADD CONSTRAINT only on the four named tables when absolutely necessary.

Uses CREATE OR REPLACE VIEW for the two views.

Inserts seed data into reliefrqst_status and reliefrqstitem_status with either:

INSERT ... ON CONFLICT DO NOTHING, or

an INSERT wrapped in WHERE NOT EXISTS checks.

No DROP TABLE, DROP COLUMN, DROP CONSTRAINT, or other destructive operations.

SQL comments explaining any place where the existing DB differs from the ideal design but you intentionally did not change it to avoid side-effects.

Only touch the relief-request objects listed above. Do not modify or reference any other tables beyond the necessary FKs to agency, event, and item.