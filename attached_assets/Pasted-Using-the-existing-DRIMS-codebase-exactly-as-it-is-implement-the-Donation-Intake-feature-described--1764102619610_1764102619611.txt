Using the existing DRIMS codebase exactly as it is, implement the Donation Intake feature described in the document “New Donation Intake Story” located at /mnt/data/New Donation Intake Story.docx. 
Do not break or modify any existing UI layouts, navigation paths, routes, workflow behavior, database schema, security fixes, or validation logic outside of what is explicitly required by this document. 
All existing functionality in DRIMS must continue to work without change.

Implement the Donation Intake Entry (Workflow A) and Donation Intake Verification (Workflow B) exactly as described in the story, including:

1. Respect all roles, statuses, and preconditions:
   - Entry Role creates and edits intake.
   - Verification Role verifies intake.
   - Only donations with donation.status_code = 'V' may be used.
   - Only donation items with itemcatg.category_type = 'GOODS' appear in intake.

2. Implement the Donation Intake Header behavior:
   - Selecting a Donation only lists donations with status 'V'.
   - Selecting an Inventory lists only active warehouses.
   - Header fields must behave exactly as described for create/update and versioning.
   - System must manage create_by_id, update_by_id, timestamps, version numbers, and status transitions (I → C → V) exactly as defined.

3. Implement the Donation Intake Items Grid behavior:
   - Only GOODS items from donation_item appear.
   - For each item card, load donation_item, item, itemcatg, and dnintake_item values.
   - Enforce quantity rules: defective_qty + expired_qty ≤ donation_item.item_qty, and auto-calculate usable_qty.
   - Respect item flags is_batched_flag and can_expire_flag.
   - Respect all date validation rules (batch_date, expiry_date).
   - uom_code must default from donation_item and remain read-only.
   - Unit Cost read-only. Extended Cost auto-calculated.

4. Implement Submit for Verification (Entry):
   - Validate all rules before saving.
   - Upsert dnintake and dnintake_item rows with the correct PKs, audit fields, status_code = 'C', and version control.
   - Entire save must be atomic. Roll back on any error.

5. Implement Verification Mode (Workflow B):
   - Show same layout but editable fields differ.
   - Verifier can adjust defective, expired, batch_no, batch_date, expiry_date, comments.
   - Submit “Verify Intake”:
        • Re-validate all rules
        • Compute deltas vs previous dnintake_item values
        • Update dnintake.status_code = 'V'
        • Update dnintake_item rows status_code = 'V'
        • Update itembatch based on batch existence rules
        • Update inventory totals and uom_code
        • All updates must occur in a single transaction with optimistic locking
   - On any conflict or error, rollback and show a meaningful message.

6. All database interactions must use the existing schema exactly as-is.
   - Do not add fields, remove fields, rename fields, alter constraints, alter PKs, or modify any database object.
   - Follow the schema rules exactly as documented.

7. Preserve all security hardening and CSP headers.
   - No new endpoints or views may bypass existing authentication and role checks.

8. Do not modify anything else in the system unless explicitly required by this story.

Follow every rule and detail in the document faithfully and implement the feature without breaking anything.
