create table reliefpkg
(
	reliefpkg_id integer not null generated by default as identity
		constraint pk_reliefpkg primary key,

	--Target agency for delivery of relief package
	agency_id integer not null
		constraint fk_reliefpkg_agency references agency,

	--Randomly generated reference/tracking number for relief package
	tracking_no char(7) not null,

	--Event for which relief was requested by agency (and
	--for which it is eligible for relief)
	eligible_event_id integer
		constraint fk_reliefpkg_event references event,

	--Target inventory (of agency) into which items will be kept							 
	to_inventory_id integer not null
		constraint fk_reliefpkg_warehouse references warehouse(warehouse_id),

	--Identifier of the request for which the package is created						   
	reliefrqst_id integer not null
		constraint fk_reliefpkg_reliefrqst references reliefrqst,

	--Date on which packaging started
	start_date date not null default CURRENT_DATE
		constraint c_reliefpkg_1 check (start_date <= CURRENT_DATE),

	--Date on which package was dispatched.
	dispatch_dtime timestamp(0) without time zone
		constraint c_reliefpkg_2
		check ((dispatch_dtime is null and status_code != 'D')
			or (dispatch_dtime is null and status_code = 'D')),

	--Mode(s) of transport for package from source inventories
	transport_mode varchar(255),

	comments_text varchar(255),

	status_code char(1) not null
		--Status of reliefpkg transaction:
		--A=Draft, P=Processing, C=Completed, V=Verified, D=Dispatched, R=Received
		constraint c_reliefpkg_3 check (status_code in ('A','P','C','V','D','R')),

	create_by_id varchar(20) not null,
	create_dtime timestamp(0) without time zone not null,
	update_by_id varchar(20) not null,
	update_dtime timestamp(0) without time zone,
	verify_by_id varchar(20) not null,
	verify_dtime timestamp(0) without time zone,
	received_by_id varchar(20) not null,
	received_dtime timestamp(0) without time zone,
	version_nbr integer not null
);
--Indexes to retrieve reliefpkg by date, source and destination Inventories
create index dk_reliefpkg_1 on reliefpkg(start_date);
create index dk_reliefpkg_3 on reliefpkg(to_inventory_id);